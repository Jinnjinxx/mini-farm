<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>카퍼농장 🐶</title>
  <style>
    body {
      margin: 0;
      background: #9cd389;
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #topbar {
      width: 100%;
      background: #6fa35a;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      box-sizing: border-box;
      font-weight: bold;
      font-size: 18px;
    }

    #farm {
      width: 480px;
      height: 480px;
      background: url('d.png');
      background-size: cover;
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(6, 1fr);
      position: relative;
      border: 5px solid #5c7a4a;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .tile {
      width: 80px;
      height: 80px;
      position: relative;
      border: 1px solid rgba(0,0,0,0.1);
    }

    #player {
      position: absolute;
      width: 80px;
      height: 80px;
      background: url('c.png') center/contain no-repeat;
      transition: top 0.2s, left 0.2s;
      z-index: 10;
    }

    .crop {
      position: absolute;
      width: 80px;
      height: 80px;
      pointer-events: none;
    }

    #shop, #inventory {
      position: absolute;
      top: 80px;
      right: 40px;
      width: 220px;
      background: rgba(255,255,255,0.9);
      border: 2px solid #6fa35a;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
      padding: 10px;
      font-size: 14px;
      display: none;
    }

    button {
      background: #6fa35a;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px 0;
    }

    button:hover {
      background: #5c8f4c;
    }
  </style>
</head>
<body>
  <div id="topbar">
    <span>💰 돈: <span id="money">100</span></span>
    <div>
      <button id="toggleShop">상점 🛒</button>
      <button id="toggleInventory">인벤토리 🎒</button>
    </div>
  </div>

  <div id="farm"></div>
  <div id="player"></div>

  <div id="shop">
    <h3>상점</h3>
    <button onclick="buySeed('basic', 10)">기본 씨앗 - 10💰</button><br>
    <button onclick="buySeed('premium', 30)">프리미엄 씨앗 - 30💰</button><br>
    <button onclick="closeShop()">닫기</button>
  </div>

  <div id="inventory">
    <h3>인벤토리</h3>
    <div id="inventoryList"></div>
    <button onclick="closeInventory()">닫기</button>
  </div>

  <script>
    const farm = document.getElementById('farm');
    const player = document.getElementById('player');
    const moneyEl = document.getElementById('money');
    const shop = document.getElementById('shop');
    const inventory = document.getElementById('inventory');
    const inventoryList = document.getElementById('inventoryList');

    let money = 100;
    let inventoryItems = JSON.parse(localStorage.getItem('inventory')) || [];
    let crops = JSON.parse(localStorage.getItem('crops')) || [];
    let playerPos = JSON.parse(localStorage.getItem('playerPos')) || { x: 0, y: 0 };

    // 농장 타일 생성
    for (let i = 0; i < 36; i++) {
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.dataset.index = i;
      tile.onclick = () => plantCrop(i);
      farm.appendChild(tile);
    }

    // 기존 작물 복원
    crops.forEach((c) => renderCrop(c.index, c.stage));

    // 캐릭터 초기 위치
    updatePlayerPosition();

    // 키보드 이동
    document.addEventListener('keydown', (e) => {
      const key = e.key.toLowerCase();
      if (key === 'w' || key === 'arrowup') playerPos.y = Math.max(0, playerPos.y - 1);
      if (key === 's' || key === 'arrowdown') playerPos.y = Math.min(5, playerPos.y + 1);
      if (key === 'a' || key === 'arrowleft') playerPos.x = Math.max(0, playerPos.x - 1);
      if (key === 'd' || key === 'arrowright') playerPos.x = Math.min(5, playerPos.x + 1);
      updatePlayerPosition();
      saveGame();
    });

    function updatePlayerPosition() {
      player.style.left = playerPos.x * 80 + 'px';
      player.style.top = playerPos.y * 80 + 'px';
    }

    // 작물 심기
    function plantCrop(index) {
      const existing = crops.find(c => c.index === index);
      if (existing) {
        if (existing.stage === 2) {
          harvestCrop(index);
        }
        return;
      }

      const seed = inventoryItems.find(i => i.name === '씨앗');
      if (!seed || seed.count <= 0) return alert('씨앗이 없습니다!');

      seed.count--;
      if (seed.count <= 0) inventoryItems = inventoryItems.filter(i => i.count > 0);
      crops.push({ index, stage: 0 });
      renderCrop(index, 0);
      saveGame();
      updateInventory();
      growCrop(index);
    }

    function renderCrop(index, stage) {
      const tile = farm.children[index];
      const img = document.createElement('img');
      img.src = stage === 0 ? 'IMG_4636.png' : stage === 1 ? 'IMG_4637.png' : 'IMG_4638.png';
      img.className = 'crop';
      tile.appendChild(img);
    }

    // 작물 성장
    function growCrop(index) {
      let stage = 0;
      const interval = setInterval(() => {
        stage++;
        const crop = crops.find(c => c.index === index);
        if (crop) crop.stage = stage;
        const tile = farm.children[index];
        tile.innerHTML = '';
        renderCrop(index, stage);
        if (stage >= 2) clearInterval(interval);
        saveGame();
      }, 5000);
    }

    // 수확
    function harvestCrop(index) {
      crops = crops.filter(c => c.index !== index);
      farm.children[index].innerHTML = '';
      money += 20;
      updateMoney();
      saveGame();
    }

    // 상점 기능
    document.getElementById('toggleShop').onclick = () => {
      shop.style.display = shop.style.display === 'none' ? 'block' : 'none';
      inventory.style.display = 'none';
    };

    function closeShop() { shop.style.display = 'none'; }

    function buySeed(type, cost) {
      if (money < cost) return alert('돈이 부족합니다!');
      money -= cost;
      updateMoney();
      addInventoryItem('씨앗', 1);
      saveGame();
      alert(`${type} 씨앗을 구입했습니다!`);
    }

    // 인벤토리 기능
    document.getElementById('toggleInventory').onclick = () => {
      inventory.style.display = inventory.style.display === 'none' ? 'block' : 'none';
      shop.style.display = 'none';
      updateInventory();
    };

    function closeInventory() { inventory.style.display = 'none'; }

    function addInventoryItem(name, count) {
      const item = inventoryItems.find(i => i.name === name);
      if (item) item.count += count;
      else inventoryItems.push({ name, count });
      updateInventory();
    }

    function updateInventory() {
      inventoryList.innerHTML = inventoryItems
        .map(i => `<div>${i.name} × ${i.count}</div>`)
        .join('');
      saveGame();
    }

    function updateMoney() {
      moneyEl.textContent = money;
      saveGame();
    }

    function saveGame() {
      localStorage.setItem('money', money);
      localStorage.setItem('inventory', JSON.stringify(inventoryItems));
      localStorage.setItem('crops', JSON.stringify(crops));
      localStorage.setItem('playerPos', JSON.stringify(playerPos));
    }

    // 불러오기
    function loadGame() {
      money = Number(localStorage.getItem('money')) || 100;
      moneyEl.textContent = money;
      updateInventory();
    }

    loadGame();
  </script>
</body>
</html>
